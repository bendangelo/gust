/* Gust 0.1.0 | MIT License */
(function(t){var e;e="undefined"!=typeof exports?exports:t.Gust={},"function"==typeof define&&"object"==typeof define.amd&&define.amd&&define(function(){return e}),e.$=function(t){return document.getElementById(t.substr(1))},function(){(function(t,e){"object"==typeof exports?module.exports=e(this):"function"==typeof define&&define.amd?define(function(){return e(t)}):t.Fiber=e(t)})(this,function(t){function e(t,e){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function n(){}var i=!1,s=Array.prototype,r=t.Fiber;return n.extend=function(t){function s(){i||(this.init.apply(this,arguments),this.init=void 0)}var r,a=this.prototype,o="function"==typeof t?t(a):t;return i=!0,r=s.prototype=new this,i=!1,r.init=function(){"function"==typeof a.init&&a.init.apply(this,arguments)},e(o,r),r.constructor=s,s.__base__=a,s.extend=s.prototype.extend||n.extend,s},n.proxy=function(t,e){var n,i,s={};1===arguments.length&&(e=t,t=e.constructor.__base__),i=function(n){return function(){return t[n].apply(e,arguments)}};for(n in t)t.hasOwnProperty(n)&&"function"==typeof t[n]&&(s[n]=i(n));return s},n.decorate=function(t){var n,i,r=t.constructor.__base__,a=s.slice.call(arguments,1),o=a.length;for(n=0;o>n;n++)i="function"==typeof a[n]?a[n].call(t,r):a[n],e(i,t)},n.mixin=function(t){var n,i,r=t.__base__,a=s.slice.call(arguments,1),o=a.length;for(n=0;o>n;n++)i="function"==typeof a[n]?a[n](r):a[n],e(i,t.prototype)},n.noConflict=function(){return t.Fiber=r,n},n})}(),e.Class=Fiber,e.Events=e.Class.extend({on:function(t,e,n){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),console.assert(e,"Event callback is null"),this._events[t].push({callback:e,context:n||this}),this},off:function(t,e){if(e){var n=this._events[t];if(n)for(var i=n.length;i--;)n[i].callback==e&&n.splice(i,1)}else t?this._events[t]=[]:this._events={}},trigger:function(t){if(!this._events||!this._events[t])return this;for(var e,n=this._events[t],i=0,s=n.length;s>i&&(e=n[i],e);i++)e.callback.apply(e.context,Array.prototype.slice.call(arguments,1));return this},listenTo:function(t,e,n){return this._listens||(this._listens=[]),t.on(e,n,this),this._listens.push({target:t,type:e,callback:n}),this},stopListening:function(t,e,n){for(var i=this._listens.length;i--;){var s=this._listens[i];t&&s.target!=t||e&&s.type!=e||n&&s.callback!=n||(s.target.off(s.type,s.callback),this._listens.splice(i,1))}return this}}),e.Manager=e.Events.extend({init:function(){this.items={}},add:function(t,e){return this.items[t]=e,this},get:function(t){return this.items[t]},remove:function(t){return delete this.items[t],this}}),e.Timer=e.Class.extend({}),e.Timer.lastTime=0,e.Timer.tick=function(){var t=Date.now(),e=this.lastTime;return this.lastTime=t,t-e},e.World=e.Class.extend({running:!1,stepSize:.03,maxTick:.05,stepProgress:0,init:function(n){n&&this.setCanvas(n),this.sceneManager=new e.SceneManager,this.groupManager=new e.GroupManager,this.assetManager=new e.AssetManager,this.requestAnimationFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)},this._requestAnimBind=this._requestAnim.bind(this)},setCanvas:function(t){return this.canvas="string"==typeof t?e.$(t):t,this.context=this.canvas.getContext("2d"),this.width=this.canvas.width,this.height=this.canvas.height,this},start:function(){this.running||(console.assert(this.sceneManager.current,"Current scene is null"),this.running=!0,this._requestAnim())},stop:function(){return this.running=!1,this},_requestAnim:function(){this.running&&(this.requestAnimationFrame.call(t,this._requestAnimBind,this.canvas),this.run())},run:function(){var t=Math.min(e.Timer.tick()/1e3,this.maxTick);this.stepProgress+=t;for(var n=0;this.stepProgress>=this.stepSize;)if(this.sceneManager.update(this.stepSize),this.stepProgress-=this.stepSize,n++>10)throw"Game loop stopped, too much lag";this.sceneManager.draw(this.context)},addNode:function(t){t=[].concat(t),this.groupManager.addNode(t)}}),e.AssetManager=e.Manager.extend({}),e.AssetManager.srcName=function(t){var e=t.split("/");return e[e.length-1]},e.GroupManager=e.Manager.extend({init:function(){e.Manager.prototype.init.apply(this,arguments),this.groups={}},add:function(t,n,i){return this.groups[t]=i,e.Manager.prototype.add.call(this,t,n)},addNode:function(t){for(var e in this.items){var n=this.items[e],i=this.groups[e];i.call(this,t,n)&&n.add(t)}return this},removeNode:function(t){for(var e in this.items){var n=this.items[e];n.remove(t)}return this}}),e.SceneManager=e.Manager.extend({current:null,enter:function(t,e){this.current&&this.current.exit(),this.current=this.items[t],console.assert(this.current,"Scene selected is null"),this.current.enter(e)},update:function(t){this.current.update(t)},draw:function(t){this.current.draw(t)}}),e.Group=e.Events.extend({length:0,init:function(t){this.nodes=[],t&&this.add(t)},add:function(t){t=[].concat(t);for(var e in t)this.nodes.push(t[e]),this.length++,this.trigger("add",t[e]);return this},remove:function(t){t=[].concat(t);for(var e in t){var n=t[e],i=this.nodes.indexOf(n);-1!=i&&(this.nodes.splice(i,1),this.length--,this.trigger("remove",n))}return this},get:function(t){for(var e in this.nodes){var n=this.nodes[e];if(n.id==t)return n}},at:function(t){return this.nodes[t]},clear:function(){for(;this.nodes.length;)this.trigger("remove",this.nodes.pop());return this.length=0,this}}),e.Map=e.Class.extend({lengthX:0,lengthY:0,defaultValue:0,init:function(t){this.copy(t||[[]])},set:function(t,e,n){for(;e>=this.data.length;){var i=Array(this.data[0]);for(var s in i)i[s]=this.defaultValue;this.data.push(i)}for(;t>=this.data[this.data.length-1].length;)for(var r=0;this.data.length>r;r++)t>=this.data[r].length&&this.data[r].push(this.defaultValue);return this.lengthX=this.data[e].length,this.lengthY=this.data.length,this.data[e][t]=n,this},get:function(t,e){return this.within(t,e)?this.data[e][t]:void 0},within:function(t,e){return e>=0&&this.lengthY>e&&t>=0&&this.lengthX>t},clear:function(){this.data=[],this.lengthX=0,this.lengthY=0},reset:function(t){for(var e=0;this.data.length>e;e++)for(var n=0;this.data[0].length>n;n++)this.data[e][n]=void 0!==t?t:this.defaultValue;return this},copy:function(t){this.data=[];for(var e=0;t.length>e;e++){this.data[e]=Array(t.length);for(var n=0;t[0].length>n;n++)this.data[e][n]=t[e][n]}return this.lengthX=t[0].length,this.lengthY=t.length,this}}),e.Node=e.Events.extend({init:function(){this.id=++e.Node._id}}),e.Node._id=0,e.Scene=e.Events.extend({init:function(t){this.world=t},enter:function(){},exit:function(){},update:function(){},draw:function(){}}),e.System=e.Class.extend({init:function(t){this.group=t},processAll:function(){var t=this.group.nodes;for(var e in t)this.process(t[e])}})})(this);